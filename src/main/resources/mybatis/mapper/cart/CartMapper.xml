<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ezen.grrreung.domain.cart.mapper.CartMapper">

    <!-- 장바구니 상품 리스트 -->
    <select id="findById" parameterType="String" resultType="map">
        SELECT i.item_name, i.item_detail, i.item_price,
               c.member_id, c.item_id,
               SUM(c.cart_amount) AS cart_amount,
               m.img_name AS item_img
        FROM
            cart c
                INNER JOIN item i ON c.item_id = i.item_id
                INNER JOIN item_img m ON i.item_id = m.item_id
        WHERE
            c.member_id = #{value}
          AND m.rep_img_yn='Y'
        GROUP BY
            i.item_name, i.item_detail, i.item_price,
            c.member_id, c.item_id,
            m.img_name
        ORDER BY
            item_id DESC
    </select>

    <!-- 장바구니에 상품 추가하기 -->
    <insert id="insertItemToCart" parameterType="Cart">
        INSERT INTO cart (cart_id, member_id, item_id, cart_amount)
        VALUES (cart_id_seq.nextval, #{memberId}, #{itemId}, #{cartAmount})
    </insert>

    <!-- 장바구니에서 체크박스선택된 상품 리스트 -->
    <select id="findByItemId" parameterType="map" resultType="map">
        SELECT i.item_name, i.item_detail, i.item_price,
               c.member_id, c.item_id,
               SUM(c.cart_amount) AS cart_amount,
               m.img_name AS item_img
        FROM
            cart c
                INNER JOIN item i ON c.item_id = i.item_id
                INNER JOIN item_img m ON i.item_id = m.item_id
        WHERE
            c.member_id = #{memberId, jdbcType=VARCHAR}
          AND m.rep_img_yn='Y'

          AND c.item_id IN (
        <foreach collection="itemIds" item="itemId" separator=",">
            #{itemId, jdbcType=INTEGER}
        </foreach>
              )

        GROUP BY
            i.item_name, i.item_detail, i.item_price,
            c.member_id, c.item_id,
            m.img_name
        ORDER BY
            item_id DESC
    </select>





</mapper>

