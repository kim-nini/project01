<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper	namespace="com.ezen.grrreung.domain.item.mapper.ItemMapper">

	<!-- 판매중인상품만 최신 등록순으로 보여주게 처리 -->
	<select id="findAllItems" resultType="Item">
	SELECT item_id,	cate_code, item_name, item_price, item_amount, item_detail,	item_sell_status
	FROM item
	WHERE item_sell_status = 'sell'
	ORDER BY item_id DESC
	</select>


	<select id="findByItemId" parameterType="int" resultType="Item">
		SELECT item_id,	cate_code, item_name, item_price, item_amount, item_detail,	item_sell_status
		FROM item
		<where>
		    <if test="item_id != null">
			 item_id = #{itemId}
			</if>
		</where>
	</select>

	<select id="findByCategory" parameterType="string" resultType="Item">
		SELECT
			c.cate_code,
			c.cate_top,
			i.item_id,
			i.item_name,
			i.item_price,
			i.item_detail,
			i.item_sell_status
		FROM
			category c
				INNER JOIN item i ON c.cate_code = i.cate_code
		WHERE
			cate_top = #{cateTop} and item_sell_status = 'sell'
		ORDER BY item_id DESC
	</select>

	<insert id="createItem" parameterType="Item">
		INSERT INTO item(item_id, cate_code, item_name, item_price ,item_amount, item_detail)
		VALUES (#{itemId}, #{cateCode}, #{itemName}, #{itemPrice}, #{itemAmount}, #{itemDetail})
	</insert>


	<select id="findThumbnail" parameterType="int" resultType="string">
		SELECT M.img_name
		FROM item_img M
				INNER JOIN item I
				ON I.item_id = M.item_id
		WHERE I.item_id = #{value} AND M.rep_img_yn= 'Y'
	</select>
	<!-- 상품 이미지 전체 불러오기-->
	<select id="findItemImages" parameterType="int" resultType="map">
		SELECT
			i.item_id,
			m.img_name,
			m.item_img_id,
			m.img_url,
			m.rep_img_yn
		FROM
			item_img m
				INNER JOIN item i ON i.item_id = m.item_id
		WHERE
			i.item_id = #{value}
	</select>

	<!-- 상세설명(이미지파일) 가져오기 -->
<!--	<select id="findDescriptionImages" parameterType="string" resultType="string">-->
<!--		SELECT-->
<!--			i.item_id,-->
<!--			m.img_name,-->
<!--			m.img_url-->
<!--		FROM-->
<!--			item_img m-->
<!--				INNER JOIN item i ON i.item_id = m.item_id-->
<!--		WHERE-->
<!--			img_name LIKE '%description%'-->
<!--	</select>-->


	<!-- 카테고리 이름 가져오기 상위카테고리명으로 검색함 -->
	<select id="findCateName" parameterType="string" resultType="Category">
		SELECT
			cate_code,
			cate_name,
			cate_top
		FROM
			category
		WHERE
			cate_top = #{value}
	</select>


</mapper>

